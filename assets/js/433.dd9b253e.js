(window.webpackJsonp=window.webpackJsonp||[]).push([[433],{719:function(s,a,t){"use strict";t.r(a);var e=t(8),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"nginx常见问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx常见问题"}},[s._v("#")]),s._v(" nginx常见问题")]),s._v(" "),a("h2",{attrs:{id:"nginx-location-加斜杠和不加斜杠"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-location-加斜杠和不加斜杠"}},[s._v("#")]),s._v(" nginx location 加斜杠和不加斜杠")]),s._v(" "),a("p",[s._v("区别在于是否匹配子路径")]),s._v(" "),a("h3",{attrs:{id:"location-users"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#location-users"}},[s._v("#")]),s._v(" location /users")]),s._v(" "),a("p",[s._v("会匹配所有以 "),a("code",[s._v("/users")]),s._v(" 开头的路径，但不会匹配/users本身，比如")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#不会匹配")]),s._v("\n/users \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 会匹配")]),s._v("\n/usersxxx\n/users/\n/users/xxx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h3",{attrs:{id:"location-users-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#location-users-2"}},[s._v("#")]),s._v(" location /users/")]),s._v(" "),a("p",[s._v("会匹配所有以 "),a("code",[s._v("/users/")]),s._v(" 开头的路径，包括 "),a("code",[s._v("/users/")]),s._v(" 本身。例如，它会匹配"),a("code",[s._v("/users/")]),s._v(" 、"),a("code",[s._v("/users/foo/")]),s._v("、"),a("code",[s._v("/users/bar/")]),s._v(" ，不会匹配/usersxxx")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#不会匹配")]),s._v("\n/users\n/usersxxx\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 会匹配")]),s._v("\n/users/\n/users/xxx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h2",{attrs:{id:"root和alias的区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#root和alias的区别"}},[s._v("#")]),s._v(" root和alias的区别")]),s._v(" "),a("p",[s._v("location内写root")]),s._v(" "),a("p",[s._v("最终的文件路径是将 "),a("code",[s._v("root")]),s._v(" 指定的路径与请求的 URI 拼接起来")]),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" /var/www")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 全局 root")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /app/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" /opt/homebrew/var/reactrouter/dist")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30008")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" localhost")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# root /opt/homebrew/var/web;")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 root 指令")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /images/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" /opt/homebrew/var/web/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 alias 指令")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /pictures/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alias")]),s._v(" /opt/homebrew/var/web/pictures/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try_files")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v("/ /index.html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("ul",[a("li",[s._v("请求 http://localhost:30008/images/data.png，匹配 /images/，root会拼上 /images/data.png，将映射到 /opt/homebrew/var/web/images/data.png")]),s._v(" "),a("li",[s._v("请求 http://localhost:30008/pictures/dora.png，匹配 /pictures/，alias会替换掉location的值，将映射到 /opt/homebrew/var/web/pictures/dora.png")])]),s._v(" "),a("h3",{attrs:{id:"alias"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#alias"}},[s._v("#")]),s._v(" alias")]),s._v(" "),a("p",[s._v("如果将上面的alias调整为alias /opt/homebrew/var/web/pictures，不以 / 结尾，则返回404")]),s._v(" "),a("p",[s._v("==所以alias要以 / 结尾==")]),s._v(" "),a("p",[s._v("举例：")]),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /skybox-aicc-portal/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" /Users/cheng/iFly/ZGH/zs-portal-zgh/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try_files")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v("/ /skybox-aicc-portal/index.html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 代理静态资源，防止 404")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /skybox-aicc-portal/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alias")]),s._v(" /Users/cheng/iFly/ZGH/zs-portal-zgh/skybox-aicc-portal/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("这里两个配置效果相同")]),s._v(" "),a("p",[a("strong",[a("code",[s._v("root")]),s._v(" 与 "),a("code",[s._v("alias")])]),s._v("：当使用 "),a("code",[s._v("root")]),s._v(" 时，Nginx 会将 URI 和 "),a("code",[s._v("root")]),s._v(" 拼接起来。而使用 "),a("code",[s._v("alias")]),s._v(" 时，Nginx 会将请求的路径替换成 "),a("code",[s._v("alias")]),s._v(" 指定的目录，避免路径拼接错误。")]),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最终访问的路径是/opt/homebrew/var/web/router/dist/app/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /app/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" /opt/homebrew/var/web/router/dist/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("expires")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1h")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try_files")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v("/ /index.html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("在使用 "),a("code",[s._v("alias")]),s._v(" 时，路径的实际解析会从 "),a("code",[s._v("alias")]),s._v(" 开始替换，所以 "),a("code",[s._v("try_files")]),s._v(" 的 "),a("code",[s._v("$uri")]),s._v(" 会映射到 "),a("code",[s._v("alias")]),s._v(" 的路径，而不是 "),a("code",[s._v("root")]),s._v(" 的路径。")]),s._v(" "),a("p",[s._v("我们以这个配置为例")]),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20003")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" localhost")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" /opt/homebrew/var/web")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /vue-app/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alias")]),s._v(" /opt/homebrew/var/web/vue-app/dist/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("expires")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1h")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try_files")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v("/ /index.html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("error_page")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),s._v(" /index.html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("在 "),a("code",[s._v("location /vue-app/")]),s._v(" 中，"),a("code",[s._v("alias")]),s._v(" 会替换掉匹配的 "),a("code",[s._v("location")]),s._v(" 前缀，因此：")]),s._v(" "),a("ul",[a("li",[s._v("请求路径 "),a("code",[s._v("/vue-app/home")]),s._v(" 实际会解析为 /opt/homebrew/var/web/vue-app/dist/home。")]),s._v(" "),a("li",[s._v("请求路径 "),a("code",[s._v("/vue-app/")]),s._v(" 实际会解析为 "),a("code",[s._v("/opt/homebrew/var/web/vue-app/dist/")]),s._v("。")])]),s._v(" "),a("p",[s._v("当使用 "),a("code",[s._v("try_files $uri $uri/ /index.html")]),s._v(" 时：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("$uri")]),s._v(" 是 "),a("code",[s._v("/vue-app/home")]),s._v("，因此会查找 "),a("code",[s._v("/opt/homebrew/var/web/vue-app/dist/vue-app/home")]),s._v("（无效）。")]),s._v(" "),a("li",[a("code",[s._v("$uri/")]),s._v(" 是 "),a("code",[s._v("/vue-app/home/")]),s._v("，因此会查找 "),a("code",[s._v("/opt/homebrew/var/web/vue-app/dist/vue-app/home/")]),s._v("（无效）。")]),s._v(" "),a("li",[s._v("回退到 "),a("code",[s._v("/index.html")]),s._v(" 时，它会解析为 "),a("code",[s._v("/opt/homebrew/var/web/index.html")]),s._v("，而不是期望的 "),a("code",[s._v("/opt/homebrew/var/web/vue-app/dist/index.html")]),s._v("。")])]),s._v(" "),a("p",[s._v("**问题：**为什么/index.html指的是"),a("code",[s._v("/opt/homebrew/var/web/index.html")]),s._v("呢")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("注意这里"),a("code",[s._v("try_files")]),s._v(" 里的 "),a("strong",[s._v("绝对路径")]),s._v("（以 "),a("code",[s._v("/")]),s._v(" 开头）是基于 server 的 root，而不是 alias")])]),s._v(" "),a("li",[a("p",[s._v("要让它回退到 alias 目录下的文件 → "),a("strong",[s._v("用相对路径")])])])]),s._v(" "),a("h3",{attrs:{id:"try-files-uri-uri-vue-app-index-html-中的-vue-app-指的是什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#try-files-uri-uri-vue-app-index-html-中的-vue-app-指的是什么"}},[s._v("#")]),s._v(" try_files $uri $uri/ /vue-app/index.html;中的/vue-app/指的是什么？")]),s._v(" "),a("blockquote",[a("p",[s._v("在 "),a("code",[s._v("try_files $uri $uri/ /vue-app/index.html;")]),s._v(" 这行配置中,/vue-app/是指浏览器url中的路径还是指资源文件在服务器上的路径?")])]),s._v(" "),a("p",[a("code",[s._v("/vue-app/index.html")]),s._v(" 指的是 "),a("strong",[s._v("浏览器 URL 路径")]),s._v("，而不是服务器上的实际文件路径。")]),s._v(" "),a("p",[s._v("如何理解"),a("code",[s._v("try_files $uri $uri/ /vue-app/index.html;")]),s._v("呢，即先找$uri，再找$uri/，找不到最终再查找/vue-app/index.html，也就是匹配/vue-app/规则")]),s._v(" "),a("h2",{attrs:{id:"alias带斜杠和不带斜杠"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#alias带斜杠和不带斜杠"}},[s._v("#")]),s._v(" alias带斜杠和不带斜杠")]),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" example.com")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 带斜杠的 alias")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /pictures/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alias")]),s._v(" /var/www/html/images/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不带斜杠的 alias")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /photos/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alias")]),s._v(" /var/www/html/images")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("ul",[a("li",[s._v("访问 "),a("code",[s._v("http://example.com/pictures/picture.jpg")]),s._v(" 将映射到 "),a("code",[s._v("/var/www/html/images/picture.jpg")]),s._v("。")]),s._v(" "),a("li",[s._v("访问 "),a("code",[s._v("http://example.com/photos/picture.jpg")]),s._v(" 将映射到 "),a("code",[s._v("/var/www/html/images/photos/picture.jpg")]),s._v("。")])]),s._v(" "),a("h3",{attrs:{id:"解释"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解释"}},[s._v("#")]),s._v(" 解释")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("带斜杠的 "),a("code",[s._v("alias")])]),s._v("：只替换 "),a("code",[s._v("location")]),s._v(" 匹配到的部分，不会添加额外的斜杠，路径直接连接。")]),s._v(" "),a("li",[a("strong",[s._v("不带斜杠的 "),a("code",[s._v("alias")])]),s._v("：在 "),a("code",[s._v("alias")]),s._v(" 路径和请求的 URI 部分之间添加一个斜杠，结果是路径连接。")])]),s._v(" "),a("h2",{attrs:{id:"return-和rewrite重定向"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#return-和rewrite重定向"}},[s._v("#")]),s._v(" return 和rewrite重定向")]),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v(" /app/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" ^/$ /app/ permanent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("return 301 和 rewrite 都可以实现重定向")]),s._v(" "),a("p",[s._v("return 301适用于简单的重定向，不需要进一步修改 URL 路径。")]),s._v(" "),a("h2",{attrs:{id:"使用302-location进行重定向"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用302-location进行重定向"}},[s._v("#")]),s._v(" 使用302 Location进行重定向")]),s._v(" "),a("h2",{attrs:{id:"子路径部署-sub-path-deploy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#子路径部署-sub-path-deploy"}},[s._v("#")]),s._v(" 子路径部署（sub-path deploy）")]),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ^~ /vue-app/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alias")]),s._v(" /Users/cheng/Github/Vue3/vue3-template/app/vue3-template/dist/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # 自动添加末尾斜杠（可选）")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rewrite ^/vue-app$ $scheme://$host$uri/ permanent;")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("expires")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1h")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # 优先尝试返回具体文件，找不到则返回 index.html")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try_files")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v("/ /vue-app/index.html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("error_page")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),s._v(" /vue-app/index.html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("为什么try_files中是 /vue-app/index.html 而不是 /index.html")]),s._v(" "),a("p",[s._v("这是子路径部署（sub-path deploy）时常见的问题，因为你的 Vue 应用 "),a("strong",[s._v("不是部署在根路径 "),a("code",[s._v("/")])]),s._v("，而是部署在:")]),s._v(" "),a("p",[s._v("/vue-app/，所以对应的 Nginx fallback（history 模式匹配不到时返回的文件）")]),s._v(" "),a("p",[a("strong",[s._v("必须匹配访问路径，而不是物理路径。")])]),s._v(" "),a("h2",{attrs:{id:"return-301-agent-和-return-301-scheme-host-agent"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#return-301-agent-和-return-301-scheme-host-agent"}},[s._v("#")]),s._v(" return 301 /agent/ 和 return 301 $scheme://$host/agent/")]),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" = /agent")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v(" /agent/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" = /agent")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$scheme")]),s._v("://"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),s._v("/agent/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h3",{attrs:{id:"一、return-301-agent-的行为"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、return-301-agent-的行为"}},[s._v("#")]),s._v(" 一、"),a("code",[s._v("return 301 /agent/")]),s._v(" 的行为")]),s._v(" "),a("ul",[a("li",[s._v("只是返回一个"),a("strong",[s._v("相对路径重定向")]),s._v("（Location: /agent/）")]),s._v(" "),a("li",[s._v("浏览器会根据当前协议和主机自动补全")]),s._v(" "),a("li",[s._v("✅ 对单域名场景一般没问题")]),s._v(" "),a("li",[s._v("❌ 如果请求是 "),a("code",[s._v("https://example.com:28082/agent")]),s._v("，浏览器会自动补全，但端口可能没问题；但是在"),a("strong",[s._v("跨域或负载均衡、代理、反代场景")]),s._v("下可能会出问题")])]),s._v(" "),a("h3",{attrs:{id:"二、return-301-scheme-host-agent-的行为"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、return-301-scheme-host-agent-的行为"}},[s._v("#")]),s._v(" 二、"),a("code",[s._v("return 301 $scheme://$host/agent/")]),s._v(" 的行为")]),s._v(" "),a("ul",[a("li",[s._v("明确"),a("strong",[s._v("协议 + 域名 + 端口")]),s._v("，返回绝对 URL")]),s._v(" "),a("li",[s._v("完全不会依赖浏览器自己补全")]),s._v(" "),a("li",[s._v("✅ 无论你前端在 HTTP、HTTPS、或者 behind proxy、负载均衡器，都会"),a("strong",[s._v("100% 正确")])]),s._v(" "),a("li",[s._v("✅ SEO 更安全，搜索引擎喜欢绝对 URL")]),s._v(" "),a("li",[s._v("✅ 可以避免 HTTPS / HTTP 自动切换问题")])]),s._v(" "),a("p",[s._v("外部 Nginx 在 443 端口转发到内部 28082")]),s._v(" "),a("p",[s._v("Location 可能被浏览器认为是相对于内部端口（某些代理环境、Docker / Kubernetes 端口映射容易出现问题）")]),s._v(" "),a("p",[s._v("访问:443/agent可能会")]),s._v(" "),a("p",[s._v("这样还有个问题，会丢失查询参数")]),s._v(" "),a("p",[s._v("解决办法")]),s._v(" "),a("h3",{attrs:{id:"args保留参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#args保留参数"}},[s._v("#")]),s._v(" $args保留参数")]),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$scheme")]),s._v("://"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$is_args")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$args")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[a("code",[s._v("$args")]),s._v(" → 原始的 query string，例如 "),a("code",[s._v("loginType=uap")])]),s._v(" "),a("li",[a("code",[s._v("$is_args")]),s._v(" → 如果 "),a("code",[s._v("$args")]),s._v(" 非空则返回 "),a("code",[s._v("?")]),s._v("，否则返回空")])]),s._v(" "),a("p",[a("code",[s._v("$is_args")]),s._v(" 和 "),a("code",[s._v("$args")]),s._v(" 都是 "),a("strong",[s._v("Nginx 的内置变量")])]),s._v(" "),a("p",[s._v("$args")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("作用")]),s._v("：表示请求的 "),a("strong",[s._v("query string")]),s._v("（问号 "),a("code",[s._v("?")]),s._v(" 后面的部分）")])]),s._v(" "),a("p",[s._v("$is_args")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("作用")]),s._v("：判断是否存在 query string，用于拼接问号 "),a("code",[s._v("?")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);