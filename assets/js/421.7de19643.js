(window.webpackJsonp=window.webpackJsonp||[]).push([[421],{709:function(s,a,t){"use strict";t.r(a);var n=t(8),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"proxy-pass"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#proxy-pass"}},[s._v("#")]),s._v(" proxy_pass")]),s._v(" "),a("p",[s._v("我们起的服务为1024端口，设置nginx代理到9001端口，9001端口起一个server，")]),s._v(" "),a("p",[s._v("访问http://127.0.0.1:9001/users/123.txt可以访问到文件")]),s._v(" "),a("h3",{attrs:{id:"proxy-pass-不加斜杠"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#proxy-pass-不加斜杠"}},[s._v("#")]),s._v(" proxy_pass 不加斜杠")]),s._v(" "),a("p",[s._v("如果 "),a("code",[s._v("proxy_pass")]),s._v(" 后不带 "),a("code",[s._v("/")]),s._v("，Nginx 会将"),a("strong",[s._v("匹配的 location URI 部分")]),s._v("直接替换为 "),a("code",[s._v("proxy_pass")]),s._v(" 指定的 URL，而不会保留匹配的部分。")]),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /images/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://127.0.0.1:30008")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("我们访问 http://localhost:27001/images/data.png，实际访问代理地址：http://127.0.0.1:30008/images/data.png")]),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /images/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://127.0.0.1:30008/images")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("访问http://localhost:27001/images/data.png，实际访问地址：http://127.0.0.1:30008/app/data.png")]),s._v(" "),a("p",[s._v("如果你希望 "),a("code",[s._v("/images/")]),s._v(" 直接映射到 "),a("code",[s._v("/app/images/")]),s._v("，你需要改成：")]),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /images/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://127.0.0.1:9001/app/images/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("这样 "),a("code",[s._v("http://localhost:1024/users/123.txt")]),s._v(" 会变成 "),a("code",[s._v("http://127.0.0.1:9001/app/users/123.txt")]),s._v("。")]),s._v(" "),a("h3",{attrs:{id:"proxy-pass-加斜杠"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#proxy-pass-加斜杠"}},[s._v("#")]),s._v(" proxy_pass 加斜杠")]),s._v(" "),a("p",[s._v("如果 "),a("code",[s._v("proxy_pass")]),s._v(" 后带有 "),a("code",[s._v("/")]),s._v("，Nginx 会 "),a("strong",[s._v("移除匹配部分")]),s._v("，然后将剩余的 URI 追加到 "),a("code",[s._v("proxy_pass")]),s._v(" 指定的 URL。")]),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /pictures/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://127.0.0.1:30008/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("我们访问 http://localhost:27001/pictures/dora.png，实际访问代理地址：http://127.0.0.1:30008/dora.png")]),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /pictures/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://127.0.0.1:30008/pictures/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("访问http://localhost:27001/pictures/dora.png，实际访问地址：http://127.0.0.1:30008/pictures/dora.png")]),s._v(" "),a("p",[s._v("总结，proxy_pass没有斜杠，则只替换ip和端口部分，有斜杠则将匹配部分后的值拼接到proxy_pass上")]),s._v(" "),a("p",[s._v("📌 "),a("strong",[s._v("记忆方法")]),s._v("：")]),s._v(" "),a("ul",[a("li",[a("strong",[a("code",[s._v("proxy_pass")]),s._v(" 不加 "),a("code",[s._v("/")])]),s._v(" → "),a("strong",[s._v("原样转发路径")])]),s._v(" "),a("li",[a("strong",[a("code",[s._v("proxy_pass")]),s._v(" 加 "),a("code",[s._v("/")])]),s._v(" → "),a("strong",[s._v("去掉 "),a("code",[s._v("location")]),s._v(" 匹配的部分")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);