(window.webpackJsonp=window.webpackJsonp||[]).push([[408],{696:function(e,s,t){"use strict";t.r(s);var a=t(8),r=Object(a.a)({},(function(){var e=this,s=e._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h2",{attrs:{id:"dockerfile"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile"}},[e._v("#")]),e._v(" Dockerfile")]),e._v(" "),s("p",[e._v("Dockerfile 文件。它是一个文本文件，用来配置 image。")]),e._v(" "),s("div",{staticClass:"language-dockerfile line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("FROM")]),e._v(" node:8.4")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("COPY")]),e._v(" . /app")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("WORKDIR")]),e._v(" /app")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("RUN")]),e._v(" npm install --registry=https://registry.npm.taobao.org")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("EXPOSE")]),e._v(" 3000")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br")])]),s("ul",[s("li",[s("code",[e._v("FROM node:8.4")]),e._v("：该 image 文件继承官方的 node image，冒号表示标签，这里标签是"),s("code",[e._v("8.4")]),e._v("，即8.4版本的 node。")]),e._v(" "),s("li",[s("code",[e._v("COPY . /app")]),e._v("：将当前目录下的所有文件（除了"),s("code",[e._v(".dockerignore")]),e._v("排除的路径），都拷贝进入 image 文件的"),s("code",[e._v("/app")]),e._v("目录。")]),e._v(" "),s("li",[s("code",[e._v("WORKDIR /app")]),e._v("：指定接下来的工作路径为"),s("code",[e._v("/app")]),e._v("。")]),e._v(" "),s("li",[s("code",[e._v("RUN npm install")]),e._v("：在"),s("code",[e._v("/app")]),e._v("目录下，运行"),s("code",[e._v("npm install")]),e._v("命令安装依赖。注意，安装后所有的依赖，都将打包进入 image 文件。")]),e._v(" "),s("li",[s("code",[e._v("EXPOSE 3000")]),e._v("：将容器 3000 端口暴露出来， 允许外部连接这个端口。")])]),e._v(" "),s("p",[e._v("我们在使用Dockerfile构建docker镜像时，一种方式是使用官方预先配置好的"),s("a",{attrs:{href:"https://cloud.tencent.com/product/tke?from=10680",target:"_blank",rel:"noopener noreferrer"}},[e._v("容器"),s("OutboundLink")],1),e._v("镜像。优点是我们不用从头开始构建，节省了很多工作量，但付出的代价是需要下载很大的镜像包。")]),e._v(" "),s("p",[e._v("从头基于空镜像scratch创建一个新的Docker镜像")]),e._v(" "),s("h2",{attrs:{id:"dockerfile命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile命令"}},[e._v("#")]),e._v(" Dockerfile命令")]),e._v(" "),s("h3",{attrs:{id:"copy"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#copy"}},[e._v("#")]),e._v(" COPY")]),e._v(" "),s("div",{staticClass:"language-dockerfile line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("COPY")]),e._v(" [--chown=<user>:<group>] <源路径>... <目标路径>")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("COPY")]),e._v(" [--chown=<user>:<group>] ["),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"<源路径1>"')]),e._v(",... "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"<目标路径>"')]),e._v("]")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("blockquote",[s("p",[e._v("每一个 "),s("code",[e._v("RUN")]),e._v(" 都是启动一个容器、执行命令、然后提交存储层文件变更。")]),e._v(" "),s("p",[e._v("https://yeasy.gitbook.io/docker_practice/image/dockerfile/workdir")])])])}),[],!1,null,null,null);s.default=r.exports}}]);