### 样式兼容性(CSS)方面

- Reset CSS

  reset 的目的，是将所有的浏览器的自带样式重置掉，这样更易于保持各浏览器渲染的一致性。

```css
/* 样式初始化 */
* {
    padding: 0;
    margin: 0;
    box-sizing: border-box;
}

ul,
ol {
    list-style: none;
}

/* 针对链接的样式 */
a {
    /* 去除链接下划线 */
    text-decoration: none;
}

img {
    /* 图片自适应 */
    width: 100%;
    display: block;
}
/* 等等具体看https://github.com/fncheng/CSS/blob/master/base.css */
```

### 交互兼容(JavaScript)

- 事件兼容





## 使用Puppeteer安装Chrome 浏览器测试兼容性

```sh
npx @puppeteer/browsers lanuch chrome@115.0.5790.170
```

这行命令的作用是：

> 使用 Puppeteer 官方的浏览器下载器，安装 **Chrome v115.0.5790.170** 版本，并在本地进行注册（不影响你系统中已有的 Chrome）。

执行后，Puppeteer 会：

1. 从 Google 官方镜像下载对应版本的 Chrome 二进制包。

2. 将其解压到本地缓存目录（默认路径如下）：

   - macOS / Linux:

     ```sh
     ~/.cache/puppeteer/
     ```

   - Windows:

     ```
     C:\Users\<用户名>\AppData\Local\puppeteer\
     ```

3. 生成一个 JSON 文件（如 `.puppeteerrc.json`），记录该版本的 Chrome 信息。

4. 安装完成后会提示类似：

   ```
   Installed browser chrome@116.0.5793.0 at:
   /Users/ted/.cache/puppeteer/chrome/mac-116.0.5793.0/chrome-mac/Chromium.app/Contents/MacOS/Chromium
   ```

   

列出所有已安装版本 `npx @puppeteer/browsers list`

### 如何启动安装的旧版chrome

```sh
npx @puppeteer/browsers launch chrome@115.0.5790.170
```

或手动运行

```sh
 ./chrome/mac_arm-115.0.5790.170/chrome-mac-arm64/Google\ Chrome\ for\ Testing.app
 /Contents/MacOS/Google\ Chrome\ for\ Testing
 --user-data-dir=/tmp/chrome-test/
```





## 记录一次兼容性处理

先看一段简单代码

```vue
<div v-if="isNewChat" :class="$style.panda">
      <!-- <img :src="pandaImg" alt="panda"> -->
      <img :src="pandaBg" alt="panda-bg" />
    </div>


<style lang="css" module>
.panda {
  position: absolute;
  right: 0;
  top: 0;
  transform:  translateY(calc(-100% + 14px));
  z-index: 50;
  img {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }
}
</style>
```

在chrome上是正常的

<img src="https://minimax-1256590847.cos.ap-shanghai.myqcloud.com/img/image-20260121110415693.png" alt="image-20260121110415693" style="zoom:80%;" />

但是在微信内置浏览器中

<img src="https://minimax-1256590847.cos.ap-shanghai.myqcloud.com/img/image-20260121110542040.png" alt="image-20260121110542040" style="zoom: 30%;" />

左边溢出了

询问AI：

> 这是一个典型的浏览器引擎差异导致的问题。
>
> Chrome 的处理方式：
>
> Chrome（基于 Blink 引擎）在遇到这种情况时：
>
> ```
> .panda {
>   position: absolute;
>   right: 0;
>   /* 没有宽度 */
>   img {
>     width: 100%;  /* 依赖父容器宽度 */
>   }
> }
> ```
>
> - 会先使用图片的固有尺寸（intrinsic size）来确定容器大小
>
> - 然后图片的 width: 100% 基于这个计算出的容器宽度渲染
>
> - 结果接近图片原始尺寸，显示正常
>
> 微信内置浏览器的处理方式：
>
> 微信内置浏览器（通常使用 X5 内核或旧版 WebKit）在相同情况下：
>
> - 可能将容器宽度计算为父元素的 100% 宽度或某个异常值
>
> - 导致图片被拉伸到很大
>
> - 即使设置了 right: 0，左边部分也会溢出屏幕



最终发现发现去掉外层的div.panda就可以了

当你去掉外层的 `div.panda`，直接在 `<img>` 标签上应用样式时，发生了以下变化：

1. **消除容器递归**：原本是 `div(absolute)` 嵌套 `img(100%)`。微信内核会纠结是先算 `div` 还是先算 `img`。现在只有一个 `img`，浏览器只需要读取图片的 **固有尺寸 (Intrinsic Size)**。
2. **明确的定位基准**：`<img>` 作为替换元素（Replaced Element），浏览器默认知道它的宽高比。当它被设置为 `position: absolute` 且没有给 `width` 时，浏览器会直接采用图片真实的像素宽度进行渲染。
3. **避开了宽度分发 Bug**：微信内核不再尝试给中间层 `div` 分配父容器的 100% 宽度，因此也就不会出现“容器太宽导致左侧溢出”的情况。
