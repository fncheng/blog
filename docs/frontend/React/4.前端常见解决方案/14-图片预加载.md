## 图片预加载

img标签会直接下载图片

而使用new Image()则可以实现预加载

封装一个预加载组件ImageLoad，包含加载中展示和加载失败展示（支持插槽）

```vue
<template>
    <slot v-if="error" name="error" class="error-placeholder">Image failed to load</slot>
    <template v-else-if="showImage">
        <img ref="imgRef" :src="imgSrc" />
    </template>
    <slot v-else name="loading" class="loading-placeholder">Image Loading...</slot>
</template>

<script setup lang="ts">
import { ref } from 'vue'

defineOptions({ name: 'NewImage' })
const { src } = defineProps<{
    src: string
}>()

const error = ref<boolean>(false)

const imgSrc = ref('')
const imgRef = ref<HTMLImageElement>()
const showImage = ref<boolean>(false)

const preload = () => {
    const img = new Image()
    img.src = src
    img.onload = () => {
        imgSrc.value = img.src
        console.log('图片预加载完成')
        showImage.value = true
    }
    img.onerror = () => {
        error.value = true
        console.error('图片加载失败')
    }
}

preload()
</script>
```



## 图片懒加载

**自定义指令**

```ts
const lazyLoadImgDirective: ObjectDirective = {
    mounted: (el: HTMLElement) => {
        if (el.tagName === 'IMG') {
            const observer = new IntersectionObserver(([entry]) => {
                if (entry.isIntersecting) {
                    const img = entry.target as HTMLImageElement
                    img.src = img.dataset.src || ''
                    img.dataset.src = ''
                    observer.unobserve(img)
                }
            })
            observer.observe(el)
        }
    }
}
```

how to use:

```html
<img data-src="https://picsum.photos/1000/2000" v-lazy-load-img />
```

