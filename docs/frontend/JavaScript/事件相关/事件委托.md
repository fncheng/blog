---
title: js事件委托
description: 事件委托，通俗地来讲，就是把一个元素响应事件（click、keydown......）的函数委托到另一个元素；通常这个元素会是当前元素的父元素.
---

### 基本概念

事件委托，通俗地来讲，就是把一个元素响应事件（click、keydown......）的函数委托到另一个元素；

### 事件捕获和事件冒泡

一般来讲，会把一个或者一组元素的事件委托到它的父层或者更外层元素上，真正绑定事件的是外层元素，当事件响应到需要绑定的元素上时，会通过**事件冒泡机制**从而触发它的外层元素的绑定事件上，然后在外层元素上去执行函数。

![](https://i.loli.net/2020/02/10/Pjci6mMzJOsFV7a.png)

我们可以在绑定事件的时候指定指是在哪个阶段触发事件，element.addEventListener(event, function, useCapture)，==useCapture默认为false==，即默认在冒泡阶段触发事件

> 事件捕获就是从上到下;事件冒泡就是从下到上。

### 功能实现

比如有这样一个HTML片段

```html
<ul id="list">
  <li>item 1</li>
  <li>item 2</li>
  <li>item 3</li>
  ......
  <li>item n</li>
</ul>
// ...... 代表中间还有未知数个 li
```

通过事件委托把li元素的事件代理委托到它的父级元素也就是ul上:

```js
// 给父层元素绑定事件
document.getElementById('list').addEventListener('click', function (e) {
  // 兼容性处理
  var event = e || window.event;
  var target = event.target || event.srcElement;
  // 判断是否匹配目标元素
  if (target.nodeName.toLocaleLowerCase === 'li') {
    console.log('the content is: ', target.innerHTML);
  }
  console.log(e.target);
});
```

**`Event.srcElement`** 是标准的 [`Event.target`](https://developer.mozilla.org/zh-CN/docs/Web/API/Event/target) 属性的一个别名。它只对老版本的IE浏览器有效。目的是兼容老版本的IE。

e.target是一个DOM元素

### stopPropagation()和preventDefault()

- `event.preventDefault()`

  阻止默认事件,例如阻止a标签的跳转

- `event.stopPropagation()`

  阻止事件冒泡,即冒泡事件到了当前元素处就终止了,不会继续向上级元素传递



## MouseEvent.relatedTarget

relatedTarget 是 DOM 事件对象（Event）中的一个属性，主要用于 焦点事件（focus events） 和 鼠标事件（mouse events） 中的某些特定场景，用来表示“与当前目标元素相关联的另一个元素”。

### **在鼠标事件中的作用（mouseenter、mouseleave）**

| 事件       | relatedTarget 的含义       |
| ---------- | -------------------------- |
| mouseenter | 鼠标离开的元素（从哪里来） |
| mouseleave | 鼠标进入的元素（到哪里去） |

示例：

```vue
<script setup lang="ts">
interface MouseRelatedEvent extends MouseEvent {
  relatedTarget: EventTarget | null
}

const handleMouseEnter = (e: MouseRelatedEvent) => {
  const from = e.relatedTarget as HTMLElement | null
  const to = e.target as HTMLElement

  console.log('鼠标从', from?.tagName || '外部', '进入', to.tagName)
}
</script>

<template>
  <div @mouseenter="handleMouseEnter" style="border: 1px solid; padding: 20px;">
    鼠标进入我
  </div>
</template>
```

> 注意：mouseover / mouseout 也会冒泡，而 mouseenter / mouseleave 不冒泡，更适合用 relatedTarget 判断“跨元素移动”。